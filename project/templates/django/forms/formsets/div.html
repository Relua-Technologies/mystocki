{% load static %}

{{ formset.management_form }}
{% block content %}
<div id="id_{{ formset.prefix }}">
    {% for form in formset %}
    {{ form }}
    {% endfor %}
    {{ formset.empty_form }}
</div>
{% endblock content %}

{% block scripts %}
{% if formset.max_num and formset.max_num > formset.total_form_count %}
<script>
    $(document).ready(function () {
        const formsetPrefix = '{{ formset.prefix }}';
        const $formsetForms = $(`#id_${formsetPrefix} .form-group`);
        const formsetDeleteCssClass = '{{ formset.delete_css_class|default:"delete-row"|escapejs }}';
        const formsetAddContainerClass = '{{ formset.add_container_class|default:""|escapejs }}';
        
        $formsetForms.formset({
            prefix: formsetPrefix,
            formTemplate: '.form-template',
            addContainerClass: formsetAddContainerClass,
            added: function (row) {
                $row = $(row);
                
                $(document).trigger(`${formsetPrefix}:form-added`, [$row]);
            
                Select2Handler.applySelect2($row);
                DatePickerHandler.applyDatePicker($row);
            },
            addText: '<button type="button" class="standard-icon-btn"><svg class="w-6 h-6 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9V4a1 1 0 0 0-1-1H8.914a1 1 0 0 0-.707.293L4.293 7.207A1 1 0 0 0 4 7.914V20a1 1 0 0 0 1 1h4M9 3v4a1 1 0 0 1-1 1H4m11 6v4m-2-2h4m3 0a5 5 0 1 1-10 0 5 5 0 0 1 10 0Z"/></svg></button>',
            removed: function (row) {
                $row = $(row);

                $(document).trigger(`${formsetPrefix}:form-removed`, [$row]);
                $rowFields = $row.find('input, select, textarea');
                $rowFields.trigger('removed'); 
            },
            deleteCssClass: formsetDeleteCssClass,
            deleteText: '<button type="button" class="standard-icon-btn"><svg class="w-6 h-6 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z" clip-rule="evenodd"/></svg></button>', 
        });
    });
</script>
{% endif %}
{% endblock scripts %}
